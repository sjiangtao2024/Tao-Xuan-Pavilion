<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº§å“ç¼–è¾‘åŠŸèƒ½è°ƒè¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #ffffff;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .debug-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #f39c12;
        }
        .debug-btn {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s;
        }
        .debug-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(243, 156, 18, 0.4);
        }
        .debug-btn.success { background: linear-gradient(135deg, #27ae60, #2ecc71); }
        .debug-btn.danger { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .debug-btn.info { background: linear-gradient(135deg, #3498db, #2980b9); }
        .log-output {
            background: #000;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            height: 200px;
            overflow-y: auto;
            border: 1px solid #333;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status.success { background: rgba(39, 174, 96, 0.2); border-left: 4px solid #27ae60; }
        .status.error { background: rgba(231, 76, 60, 0.2); border-left: 4px solid #e74c3c; }
        .status.info { background: rgba(52, 152, 219, 0.2); border-left: 4px solid #3498db; }
        .status.warning { background: rgba(243, 156, 18, 0.2); border-left: 4px solid #f39c12; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ äº§å“ç¼–è¾‘åŠŸèƒ½è°ƒè¯•é¡µé¢</h1>
        <p>ç”¨äºæµ‹è¯•å’Œè°ƒè¯•äº§å“ç¼–è¾‘åŠŸèƒ½çš„å„ä¸ªç»„ä»¶</p>
        
        <div class="debug-section">
            <h3>ğŸ“‹ æ¨¡å—åŠ è½½çŠ¶æ€æ£€æŸ¥</h3>
            <div id="module-status"></div>
            <button class="debug-btn info" onclick="checkModuleStatus()">æ£€æŸ¥æ¨¡å—çŠ¶æ€</button>
            <button class="debug-btn" onclick="loadModules()">åŠ è½½æ¨¡å—</button>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ§ª åŠŸèƒ½æµ‹è¯•</h3>
            <button class="debug-btn success" onclick="testCreateProduct()">æµ‹è¯•åˆ›å»ºäº§å“</button>
            <button class="debug-btn" onclick="testEditProduct()">æµ‹è¯•ç¼–è¾‘äº§å“</button>
            <button class="debug-btn info" onclick="testLanguageSwitch()">æµ‹è¯•è¯­è¨€åˆ‡æ¢</button>
            <button class="debug-btn danger" onclick="testErrorHandling()">æµ‹è¯•é”™è¯¯å¤„ç†</button>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ“Š è°ƒè¯•æ—¥å¿—</h3>
            <button class="debug-btn" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
            <button class="debug-btn info" onclick="exportLog()">å¯¼å‡ºæ—¥å¿—</button>
            <div id="log-output" class="log-output"></div>
        </div>
        
        <div class="debug-section">
            <h3>âš¡ å¿«é€Ÿä¿®å¤</h3>
            <button class="debug-btn warning" onclick="reinitializeModules()">é‡æ–°åˆå§‹åŒ–æ¨¡å—</button>
            <button class="debug-btn" onclick="refreshPage()">åˆ·æ–°é¡µé¢</button>
        </div>
    </div>

    <script>
        // è°ƒè¯•æ—¥å¿—åŠŸèƒ½
        const logOutput = document.getElementById('log-output');
        let debugLogs = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            debugLogs.push(logEntry);
            
            const logElement = document.createElement('div');
            logElement.textContent = logEntry;
            logElement.style.color = getLogColor(type);
            logOutput.appendChild(logElement);
            logOutput.scrollTop = logOutput.scrollHeight;
            
            console.log(logEntry);
        }

        function getLogColor(type) {
            switch(type) {
                case 'error': return '#ff6b6b';
                case 'warning': return '#feca57';
                case 'success': return '#48dbfb';
                case 'info': 
                default: return '#00ff00';
            }
        }

        function clearLog() {
            logOutput.innerHTML = '';
            debugLogs = [];
            log('æ—¥å¿—å·²æ¸…ç©º', 'info');
        }

        function exportLog() {
            const logText = debugLogs.join('\\n');
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `product-editor-debug-${new Date().toISOString().slice(0,19)}.log`;
            a.click();
            URL.revokeObjectURL(url);
            log('æ—¥å¿—å·²å¯¼å‡º', 'success');
        }

        // æ¨¡å—çŠ¶æ€æ£€æŸ¥
        function checkModuleStatus() {
            log('å¼€å§‹æ£€æŸ¥æ¨¡å—çŠ¶æ€...', 'info');
            
            const modules = {
                'initializeProductEditor': typeof window.initializeProductEditor,
                'openProductEditor': typeof window.openProductEditor,
                'closeProductEditor': typeof window.closeProductEditor,
                'initializeProductManagementModule': typeof window.initializeProductManagementModule,
                'addNewProduct': typeof window.addNewProduct,
                'viewProduct': typeof window.viewProduct,
                'switchLanguage': typeof window.switchLanguage
            };
            
            const statusDiv = document.getElementById('module-status');
            let statusHTML = '';
            let allReady = true;
            
            for (const [moduleName, status] of Object.entries(modules)) {
                const isReady = status === 'function';
                if (!isReady) allReady = false;
                
                statusHTML += `
                    <div class="status ${isReady ? 'success' : 'error'}">
                        <strong>${moduleName}</strong>: ${status}
                        ${isReady ? 'âœ…' : 'âŒ'}
                    </div>
                `;
                
                log(`${moduleName}: ${status}`, isReady ? 'success' : 'error');
            }
            
            statusDiv.innerHTML = statusHTML;
            
            if (allReady) {
                log('æ‰€æœ‰æ¨¡å—éƒ½å·²æ­£ç¡®åŠ è½½ï¼', 'success');
            } else {
                log('éƒ¨åˆ†æ¨¡å—æœªæ­£ç¡®åŠ è½½ï¼Œéœ€è¦æ£€æŸ¥', 'warning');
            }
        }

        // åŠ è½½æ¨¡å—
        async function loadModules() {
            log('å¼€å§‹åŠ è½½æ¨¡å—...', 'info');
            
            try {
                // æ¨¡æ‹Ÿæ¨¡å—åŠ è½½
                log('æ­£åœ¨åŠ è½½äº§å“ç®¡ç†æ¨¡å—...', 'info');
                await loadScript('/modules/product-management.js');
                
                log('æ­£åœ¨åŠ è½½äº§å“ç¼–è¾‘å™¨æ¨¡å—...', 'info');
                await loadScript('/modules/product-editor.js');
                
                // ç­‰å¾…æ¨¡å—åˆå§‹åŒ–
                setTimeout(() => {
                    checkModuleStatus();
                    log('æ¨¡å—åŠ è½½å®Œæˆ', 'success');
                }, 1000);
                
            } catch (error) {
                log(`æ¨¡å—åŠ è½½å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        // æµ‹è¯•åŠŸèƒ½
        function testCreateProduct() {
            log('æµ‹è¯•åˆ›å»ºäº§å“åŠŸèƒ½...', 'info');
            
            if (typeof window.openProductEditor === 'function') {
                try {
                    window.openProductEditor(null, 'create');
                    log('åˆ›å»ºäº§å“æµ‹è¯•æˆåŠŸï¼', 'success');
                } catch (error) {
                    log(`åˆ›å»ºäº§å“æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }
            } else {
                log('openProductEditor å‡½æ•°æœªæ‰¾åˆ°', 'error');
                if (typeof window.addNewProduct === 'function') {
                    try {
                        window.addNewProduct();
                        log('ä½¿ç”¨ addNewProduct æ›¿ä»£æµ‹è¯•æˆåŠŸ', 'warning');
                    } catch (error) {
                        log(`addNewProduct æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                    }
                } else {
                    log('addNewProduct å‡½æ•°ä¹Ÿæœªæ‰¾åˆ°', 'error');
                }
            }
        }

        function testEditProduct() {
            log('æµ‹è¯•ç¼–è¾‘äº§å“åŠŸèƒ½...', 'info');
            
            const mockProduct = {
                id: 1,
                name_zh: 'æµ‹è¯•äº§å“',
                name_en: 'Test Product',
                price: 29.99,
                description_zh: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•äº§å“çš„æè¿°',
                description_en: 'This is a test product description',
                featured: true
            };
            
            if (typeof window.openProductEditor === 'function') {
                try {
                    window.openProductEditor(mockProduct, 'edit');
                    log('ç¼–è¾‘äº§å“æµ‹è¯•æˆåŠŸï¼', 'success');
                } catch (error) {
                    log(`ç¼–è¾‘äº§å“æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }
            } else {
                log('openProductEditor å‡½æ•°æœªæ‰¾åˆ°', 'error');
                if (typeof window.viewProduct === 'function') {
                    try {
                        window.viewProduct(1);
                        log('ä½¿ç”¨ viewProduct æ›¿ä»£æµ‹è¯•', 'warning');
                    } catch (error) {
                        log(`viewProduct æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                    }
                } else {
                    log('viewProduct å‡½æ•°ä¹Ÿæœªæ‰¾åˆ°', 'error');
                }
            }
        }

        function testLanguageSwitch() {
            log('æµ‹è¯•è¯­è¨€åˆ‡æ¢åŠŸèƒ½...', 'info');
            
            if (typeof window.switchLanguage === 'function') {
                try {
                    window.switchLanguage('en');
                    log('åˆ‡æ¢åˆ°è‹±æ–‡æˆåŠŸ', 'success');
                    
                    setTimeout(() => {
                        window.switchLanguage('zh');
                        log('åˆ‡æ¢åˆ°ä¸­æ–‡æˆåŠŸ', 'success');
                    }, 1000);
                } catch (error) {
                    log(`è¯­è¨€åˆ‡æ¢æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }
            } else {
                log('switchLanguage å‡½æ•°æœªæ‰¾åˆ°', 'error');
            }
        }

        function testErrorHandling() {
            log('æµ‹è¯•é”™è¯¯å¤„ç†...', 'info');
            
            try {
                // æµ‹è¯•ä¸å­˜åœ¨çš„å‡½æ•°è°ƒç”¨
                if (typeof nonExistentFunction === 'function') {
                    nonExistentFunction();
                } else {
                    log('é”™è¯¯å¤„ç†æµ‹è¯•ï¼šå‡½æ•°ä¸å­˜åœ¨æ£€æµ‹æ­£å¸¸', 'success');
                }
                
                // æµ‹è¯•ç©ºå‚æ•°
                if (typeof window.openProductEditor === 'function') {
                    window.openProductEditor(undefined, 'invalid_mode');
                    log('é”™è¯¯å¤„ç†æµ‹è¯•ï¼šç©ºå‚æ•°å¤„ç†æ­£å¸¸', 'success');
                }
                
            } catch (error) {
                log(`é”™è¯¯å¤„ç†æµ‹è¯•æ•è·å¼‚å¸¸: ${error.message}`, 'warning');
            }
        }

        function reinitializeModules() {
            log('é‡æ–°åˆå§‹åŒ–æ¨¡å—...', 'info');
            
            const modules = [
                'initializeProductEditor',
                'initializeProductManagementModule'
            ];
            
            modules.forEach(moduleName => {
                if (typeof window[moduleName] === 'function') {
                    try {
                        window[moduleName]();
                        log(`${moduleName} é‡æ–°åˆå§‹åŒ–æˆåŠŸ`, 'success');
                    } catch (error) {
                        log(`${moduleName} é‡æ–°åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
                    }
                } else {
                    log(`${moduleName} å‡½æ•°æœªæ‰¾åˆ°`, 'warning');
                }
            });
            
            setTimeout(checkModuleStatus, 500);
        }

        function refreshPage() {
            log('åˆ·æ–°é¡µé¢...', 'info');
            window.location.reload();
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('è°ƒè¯•é¡µé¢å·²åŠ è½½', 'info');
            log('æ¨¡æ‹ŸlocalStorage adminToken', 'info');
            
            // è®¾ç½®æ¨¡æ‹Ÿçš„ç®¡ç†å‘˜token
            if (!localStorage.getItem('adminToken')) {
                localStorage.setItem('adminToken', 'debug-token-12345');
                log('å·²è®¾ç½®è°ƒè¯•ç”¨çš„adminToken', 'info');
            }
            
            // å»¶è¿Ÿæ£€æŸ¥æ¨¡å—çŠ¶æ€
            setTimeout(() => {
                checkModuleStatus();
            }, 1000);
        });
    </script>
</body>
</html>