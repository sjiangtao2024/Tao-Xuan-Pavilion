<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tao Xuan Pavilion - Find Taoist Artifacts</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/responsive.css">
    <style>
        :root {
            --bg-mystic-black: #1C1C1C;
            --bg-talisman-yellow: #EAE0C8;
            --text-on-dark: #EAE0C8;
            --text-on-light: #1C1C1C;
            --primary-cinnabar-red: #B83B1D;
            --primary-cinnabar-red-hover: #d14f31;
            --accent-gilded-gold: #A88F5A;
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-mystic-black); color: var(--text-on-dark); }
        .font-serif-sc { font-family: 'Noto Serif SC', serif; }
        .product-card { transition: transform 0.3s ease, box-shadow 0.3s ease; background-color: var(--bg-talisman-yellow); color: var(--text-on-light); border: 1px solid var(--accent-gilded-gold); }
        .product-card:hover { transform: translateY(-8px); box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5); }
        .btn-primary { background-color: var(--primary-cinnabar-red); color: var(--text-on-dark); transition: background-color 0.3s ease; font-weight: bold; }
        .btn-primary:hover { background-color: var(--primary-cinnabar-red-hover); }
        .nav-link { position: relative; transition: color 0.3s ease; color: var(--text-on-dark); }
        .nav-link:hover { color: var(--accent-gilded-gold); }
        .nav-link::after { content: ''; position: absolute; width: 0; height: 2px; bottom: -4px; left: 50%; transform: translateX(-50%); background-color: var(--primary-cinnabar-red); transition: width 0.3s ease; }
        .nav-link:hover::after, .nav-link.active::after { width: 100%; }
        .lang-switcher button.active { color: var(--primary-cinnabar-red); font-weight: bold; }
        .text-primary { color: var(--primary-cinnabar-red); }
        .text-gold { color: var(--accent-gilded-gold); }
        .focus-ring-primary:focus { --tw-ring-color: var(--primary-cinnabar-red); border-color: var(--primary-cinnabar-red); }
        .carousel { position: relative; width: 100%; overflow: hidden; max-width: 600px; margin: 0 auto; }
        .carousel-inner { display: flex; transition: transform 0.5s ease; }
        .carousel-item { min-width: 100%; box-sizing: border-box; }
        .carousel-item img, .carousel-item video { width: 100%; display: block; border-radius: 0.5rem; }
        .carousel-control { position: absolute; top: 50%; transform: translateY(-50%); background-color: rgba(0, 0, 0, 0.5); color: white; border: none; padding: 0.5rem 1rem; cursor: pointer; border-radius: 50%; z-index: 10; font-size: 1.5rem; line-height: 1; }
        .carousel-control.prev { left: 1rem; }
        .carousel-control.next { right: 1rem; }
        
        /* äº§å“ç½‘æ ¼å¹³æ»‘è¿‡æ¸¡æ•ˆæœ */
        #products-grid {
            transition: opacity 0.3s ease;
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            -webkit-backdrop-filter: blur(4px);
            backdrop-filter: blur(4px);
        }
        
        .modal-content {
            background-color: var(--bg-talisman-yellow);
            color: var(--text-on-light);
            border-radius: 0.75rem;
            padding: 2rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            max-width: 28rem;
            width: 100%;
            margin: 0 1rem;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--accent-gilded-gold);
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-gilded-gold);
            margin: 0;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--text-on-light);
            cursor: pointer;
            padding: 0.25rem;
            line-height: 1;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }
        
        .modal-close:hover {
            opacity: 1;
        }
        
        /* è¡¨å•æ ·å¼ */
        .form-group {
            margin-bottom: 1.25rem;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            color: var(--text-on-light);
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }
        
        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1rem;
            background-color: white;
            color: var(--text-on-light);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary-cinnabar-red);
            box-shadow: 0 0 0 3px rgba(184, 59, 29, 0.1);
        }
        
        .form-error {
            display: none;
            color: #dc2626;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }
        
        .w-full {
            width: 100%;
        }
        
        .text-center {
            text-align: center;
        }
        
        .text-sm {
            font-size: 0.875rem;
        }
        
        .ml-1 {
            margin-left: 0.25rem;
        }
        
        .mt-2 {
            margin-top: 0.5rem;
        }
        
        .hover\:underline:hover {
            text-decoration: underline;
        }
        
        /* æ¶ˆæ¯æç¤ºæ ·å¼ */
        .message-modal {
            position: fixed;
            top: 20px;
            right: 20px;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 9999;
            transform: translateX(120%);
            transition: transform 0.5s ease;
            max-width: 300px;
            font-weight: 500;
        }
        
        .message-modal.show {
            transform: translateX(0);
        }
        
        .message-modal.success {
            background-color: #10b981;
        }
        
        .message-modal.error {
            background-color: #ef4444;
        }
        
        .message-modal.warning {
            background-color: #f59e0b;
        }
        
        .message-modal.info {
            background-color: #3b82f6;
        }
    </style>
</head>
<body>

    <header class="bg-black bg-opacity-60 backdrop-blur-sm sticky top-0 z-50 shadow-lg shadow-black/30 border-b border-white/10">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-serif-sc font-bold tracking-wider text-gold" data-lang-key="siteName">Tao Xuan Pavilion</h1>
            <nav class="hidden md:flex items-center space-x-8">
                <a href="#home" class="nav-link text-lg active" onclick="showPage('home')" data-page="home" data-lang-key="navHome">Home</a>
                <a href="#shop" class="nav-link text-lg" onclick="showPage('shop')" data-page="shop" data-lang-key="navShop">All Artifacts</a>
                <a href="#about" class="nav-link text-lg" onclick="showPage('about')" data-page="about" data-lang-key="navAbout">About Us</a>
                <a href="#contact" class="nav-link text-lg" onclick="showPage('contact')" data-page="contact" data-lang-key="navContact">Contact Us</a>
            </nav>
            <div class="flex items-center space-x-4">
                <div class="lang-switcher text-gray-300 text-sm">
                    <button id="lang-zh" class="hover:text-white transition">ä¸­æ–‡</button>
                    <span>/</span>
                    <button id="lang-en" class="hover:text-white transition">English</button>
                </div>
                <div id="auth-container">
                    <button id="login-button" class="btn-primary px-4 py-2 rounded-md text-sm" data-lang-key="login">Login</button>
                    <div id="user-profile" class="hidden items-center space-x-2">
                        <span id="user-email" class="text-gold text-sm"></span>
                        <span class="text-gray-400">|</span>
                        <button id="profile-button" class="text-gold hover:text-primary text-sm" onclick="showPage('profile')" data-lang-key="profile">Profile</button>
                        <span class="text-gray-400">|</span>
                        <button id="logout-button" class="text-gray-400 hover:text-white text-sm" data-lang-key="logout">Logout</button>
                    </div>
                </div>
                <button id="cart-button" class="relative">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-gray-300 hover:text-gold transition" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                    <span id="cart-count" class="absolute -top-2 -right-2 bg-red-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                </button>
            </div>
        </div>
    </header>

    <main id="app-content">
        <div id="home-page" class="page"></div>
        <div id="shop-page" class="page hidden"></div>
        <div id="product-page" class="page hidden"></div>
        <div id="profile-page" class="page hidden"></div>
        <div id="about-page" class="page hidden"></div>
        <div id="contact-page" class="page hidden"></div>
    </main>

    <div id="login-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 hidden flex items-center justify-center"></div>
    <div id="register-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 hidden flex items-center justify-center"></div>
    <div id="cart-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 hidden flex items-center justify-center"></div>
    <div id="message-modal" class="fixed top-20 right-5 text-white py-3 px-6 rounded-lg shadow-lg z-50 transform translate-x-[120%] transition-transform duration-500"><p id="message-text"></p></div>

    <!-- é¡µè„š -->
    <footer class="bg-black bg-opacity-80 backdrop-blur-sm border-t border-white/10 mt-auto">
        <div class="container mx-auto px-6 py-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-xl font-serif-sc font-bold text-gold mb-4" data-lang-key="siteName">Tao Xuan Pavilion</h3>
                    <p class="text-gray-400 text-sm leading-relaxed">
                        <span data-lang-key="aboutMissionText">Discover ancient artifacts imbued with mystical powers</span>
                    </p>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4" data-lang-key="navContact">Contact Us</h4>
                    <div class="text-gray-400 text-sm space-y-2">
                        <p data-lang-key="contactEmail">Email: support@taoxuan.com</p>
                        <p data-lang-key="contactPhone">Phone: +86 400-888-0000</p>
                        <p data-lang-key="contactHours">Business Hours: 9:00 AM - 6:00 PM (UTC+8)</p>
                    </div>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">Links</h4>
                    <div class="text-gray-400 text-sm space-y-2">
                        <a href="#about" class="block hover:text-gold transition" onclick="showPage('about')" data-lang-key="navAbout">About Us</a>
                        <a href="#contact" class="block hover:text-gold transition" onclick="showPage('contact')" data-lang-key="navContact">Contact Us</a>
                        <a href="#" class="block hover:text-gold transition" data-lang-key="footerPrivacy">Privacy Policy</a>
                        <a href="#" class="block hover:text-gold transition" data-lang-key="footerTerms">Terms of Service</a>
                        <a href="#" class="block hover:text-gold transition" data-lang-key="footerReturns">Return Policy</a>
                    </div>
                </div>
            </div>
            <div class="border-t border-white/10 mt-8 pt-8 text-center">
                <p class="text-gray-500 text-sm" data-lang-key="footerCopyright">&copy; 2024 Tao Xuan Pavilion. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- å…¨å±€å‡½æ•°å®šä¹‰ - åŒ¹é…åŸå§‹frontend.htmlçš„å…¨å±€å‡½æ•° -->
    <script>
        // å…¨å±€å‡½æ•° - å®Œå…¨åŒ¹é…åŸå§‹frontend.html
        function showPage(pageId) {
            if (window.NavigationModule) {
                window.NavigationModule.navigateTo(pageId);
            }
            
            // æ›´æ–°å¯¼èˆªé“¾æ¥çŠ¶æ€
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`[onclick="showPage('${pageId}')"]`)?.classList.add('active');
        }
        
        function showProductDetail(productId) {
            window.DEBUG_UTILS.log('product', 'showProductDetail called with productId:', productId);
            
            if (!window.ProductModule) {
                window.DEBUG_UTILS.error('product', 'ProductModule not available!');
                return;
            }
            
            if (!window.NavigationModule) {
                window.DEBUG_UTILS.error('product', 'NavigationModule not available!');
                return;
            }
            
            // ç¡®ä¿ productId æ˜¯æ•°å­—ç±»å‹
            const numericProductId = typeof productId === 'string' ? parseInt(productId) : productId;
            window.DEBUG_UTILS.log('product', 'Setting currentProductId to:', numericProductId);
            
            // è®¾ç½®å½“å‰äº§å“ID
            window.APP_STATE.currentProductId = numericProductId;
            
            // æ£€æŸ¥ updateUrlWithProductId å‡½æ•°æ˜¯å¦å­˜åœ¨
            window.DEBUG_UTILS.log('product', 'æ£€æŸ¥ updateUrlWithProductId å‡½æ•°:', typeof updateUrlWithProductId);
            
            // éªŒè¯è®¾ç½®æ˜¯å¦æˆåŠŸ
            window.DEBUG_UTILS.success('product', 'APP_STATE.currentProductId is now:', window.APP_STATE.currentProductId);
            
            // å…ˆå¯¼èˆªåˆ°äº§å“é¡µé¢ï¼Œä½†ä¸æ›´æ–°URLå†å²
            window.DEBUG_UTILS.log('product', 'å¯¼èˆªåˆ°äº§å“é¡µé¢...');
            window.NavigationModule.navigateTo('product', false); // false = ä¸æ¨é€åˆ°å†å²è®°å½•
            
            // ç„¶åæ›´æ–° URL ä»¥ä¿æŒäº§å“IDï¼ˆæ”¯æŒåˆ·æ–°ï¼‰
            try {
                window.DEBUG_UTILS.log('product', 'å‡†å¤‡è°ƒç”¨ updateUrlWithProductId...');
                updateUrlWithProductId(numericProductId);
                window.DEBUG_UTILS.success('product', 'updateUrlWithProductId è°ƒç”¨å®Œæˆ');
            } catch (error) {
                window.DEBUG_UTILS.error('product', 'updateUrlWithProductId è°ƒç”¨å¤±è´¥:', error);
            }
        }
        
        // æ›´æ–° URL ä»¥åŒ…å«äº§å“ ID
        function updateUrlWithProductId(productId) {
            window.DEBUG_UTILS.log('product', 'updateUrlWithProductId è¢«è°ƒç”¨ï¼Œäº§å“ID:', productId);
            window.DEBUG_UTILS.log('product', 'å½“å‰ URL:', window.location.href);
            
            const newUrl = `${window.location.origin}${window.location.pathname}#product?id=${productId}`;
            window.DEBUG_UTILS.log('product', 'æ–° URL:', newUrl);
            
            try {
                // ä½¿ç”¨ replaceState è€Œä¸æ˜¯ pushStateï¼Œé¿å…äº§ç”Ÿé¢å¤–çš„å†å²è®°å½•
                window.history.replaceState({ page: 'product', productId: productId }, '', newUrl);
                window.DEBUG_UTILS.success('product', 'URL æ›´æ–°æˆåŠŸ (replaceState)');
                window.DEBUG_UTILS.log('product', 'æ›´æ–°åçš„ URL:', window.location.href);
                
                // éªŒè¯ hash æ˜¯å¦æ­£ç¡®è®¾ç½®
                window.DEBUG_UTILS.log('product', 'éªŒè¯ window.location.hash:', window.location.hash);
                window.DEBUG_UTILS.log('product', 'éªŒè¯ window.location.search:', window.location.search);
                
                // æ‰‹åŠ¨è®¾ç½® hashï¼Œç¡®ä¿æµè§ˆå™¨æ­£ç¡®è¯†åˆ«
                if (!window.location.hash.includes(`id=${productId}`)) {
                    window.DEBUG_UTILS.warn('product', 'Hash å‚æ•°æœªæ­£ç¡®è®¾ç½®ï¼Œæ‰‹åŠ¨ä¿®æ­£...');
                    window.location.hash = `product?id=${productId}`;
                    window.DEBUG_UTILS.log('product', 'æ‰‹åŠ¨è®¾ç½®åçš„ hash:', window.location.hash);
                }
                
            } catch (error) {
                window.DEBUG_UTILS.error('product', 'URL æ›´æ–°å¤±è´¥:', error);
                // å¦‚æœ history API å¤±è´¥ï¼Œç›´æ¥è®¾ç½® hash
                window.DEBUG_UTILS.log('product', 'å°è¯•ç›´æ¥è®¾ç½® hash...');
                window.location.hash = `product?id=${productId}`;
            }
        }
        
        // ä» URL ä¸­è·å–äº§å“ ID
        function getProductIdFromUrl() {
            window.DEBUG_UTILS.log('product', 'å…¨å±€ getProductIdFromUrl è¢«è°ƒç”¨');
            window.DEBUG_UTILS.log('product', 'å½“å‰ URL ä¿¡æ¯:', {
                href: window.location.href,
                hash: window.location.hash,
                search: window.location.search
            });
            
            const hash = window.location.hash;
            
            // æ”¯æŒå¤šç§ URL æ ¼å¼
            const patterns = [
                /[#&]product.*[?&]id=([^&]+)/,  // #product?id=123 æˆ– #product&id=123
                /#product\?id=([^&]+)/,          // #product?id=123
                /#product&id=([^&]+)/,           // #product&id=123  
                /\?id=([^&]+)/,                  // ?id=123
                /&id=([^&]+)/                    // &id=123
            ];
            
            for (let i = 0; i < patterns.length; i++) {
                const match = hash.match(patterns[i]);
                if (match) {
                    const productId = parseInt(match[1]);
                    window.DEBUG_UTILS.success('product', `ä½¿ç”¨æ¨¡å¼ ${i + 1} æ‰¾åˆ°äº§å“ID:`, productId);
                    return productId;
                }
            }
            
            // å¦‚æœ hashä¸­æ²¡æœ‰ï¼Œæ£€æŸ¥ search å‚æ•°
            const searchParams = new URLSearchParams(window.location.search);
            const searchId = searchParams.get('id');
            if (searchId) {
                const productId = parseInt(searchId);
                window.DEBUG_UTILS.success('product', 'ä» search å‚æ•°æ‰¾åˆ°äº§å“ID:', productId);
                return productId;
            }
            
            window.DEBUG_UTILS.warn('product', 'æœªæ‰¾åˆ°äº§å“ID');
            return null;
        }
        
        function addToCart(productId, quantity = 1) {
            if (window.CartModule) {
                const product = window.ShopModule.allProducts.find(p => p.id === productId);
                if (product) {
                    window.CartModule.addItem(product, quantity);
                }
            }
        }
        
        // è”ç³»è¡¨å•å¤„ç† - åŒ¹é…åŸå§‹frontend.html
        function handleContactForm(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            
            // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„è¡¨å•æäº¤é€»è¾‘
            // ä¾‹å¦‚å‘é€åˆ°åç«¯APIæˆ–ç¬¬ä¸‰æ–¹æœåŠ¡
            
            if (window.MessageComponent) {
                window.MessageComponent.success('æ„Ÿè°¢æ‚¨çš„ç•™è¨€ï¼æˆ‘ä»¬ä¼šå°½å¿«å›å¤æ‚¨ã€‚');
            }
            event.target.reset();
        }
    </script>
    
    <!-- æ ¸å¿ƒJavaScriptæ–‡ä»¶ï¼ˆæŒ‰ä¾èµ–é¡ºåºåŠ è½½ï¼‰ -->
    <script src="js/config.js"></script>
    <script>
        // ğŸ¯ è°ƒè¯•è¾“å‡ºæ§åˆ¶è¯´æ˜
        // é»˜è®¤æƒ…å†µä¸‹ï¼Œè°ƒè¯•è¾“å‡ºæ˜¯å…³é—­çš„
        // è¦å¯ç”¨è°ƒè¯•è¾“å‡ºï¼Œè¯·åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š
        // 
        // enableDebug()     - å¯ç”¨å…¨å±€è°ƒè¯•æ¨¡å¼
        // debugDev()        - å¼€å‘è€…æ¨¡å¼ï¼ˆæ˜¾ç¤ºæ‰€æœ‰è°ƒè¯•ä¿¡æ¯ï¼‰
        // debugProd()       - ç”Ÿäº§æ¨¡å¼ï¼ˆå…³é—­æ‰€æœ‰è°ƒè¯•ä¿¡æ¯ï¼‰
        // debugModule('product', true)  - åªæ˜¾ç¤ºäº§å“æ¨¡å—çš„è°ƒè¯•ä¿¡æ¯
        // debugHelp()       - æ˜¾ç¤ºå®Œæ•´çš„è°ƒè¯•å¸®åŠ©
        //
        // ç¤ºä¾‹ï¼šè¦åªæŸ¥çœ‹äº§å“ç›¸å…³çš„è°ƒè¯•ä¿¡æ¯ï¼Œæ‰§è¡Œï¼š
        // debugModule('product', true)
        // debugModule('navigation', true)
    </script>
    <script src="js/utils.js"></script>
    <script src="i18n/zh.js"></script>
    <script src="i18n/en.js"></script>
    <script src="i18n/i18n.js"></script>
    <script src="components/modal.js"></script>
    <script src="components/message.js"></script>
    <script src="components/carousel.js"></script>
    <script src="modules/auth.js"></script>
    <script src="modules/google-oauth.js"></script>
    <script src="modules/cart.js"></script>
    <script src="modules/shop.js"></script>
    <script src="modules/product.js"></script>
    <script src="modules/profile.js"></script>
    <script src="modules/navigation.js"></script>
    <script src="js/app.js"></script>
    
    <!-- æ¨¡å—åˆå§‹åŒ–ä¿®å¤è„šæœ¬ï¼ˆä¸´æ—¶ï¼‰ -->
    
    <!-- å¼€å‘ç¯å¢ƒéªŒè¯è„šæœ¬ -->
    <script src="js/validation.js"></script>
</body>
</html>