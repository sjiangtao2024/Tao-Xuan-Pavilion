<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google OAuth è°ƒè¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .status-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status-good { border-left: 4px solid #10b981; }
        .status-warning { border-left: 4px solid #f59e0b; }
        .status-error { border-left: 4px solid #ef4444; }
        .btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover { background: #2563eb; }
        #debug-log {
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Google OAuth è°ƒè¯•å·¥å…·</h1>
    
    <div class="status-card">
        <h3>ç³»ç»ŸçŠ¶æ€æ£€æŸ¥</h3>
        <div id="system-status"></div>
    </div>
    
    <div class="status-card">
        <h3>æ“ä½œæ§åˆ¶</h3>
        <button class="btn" onclick="checkOAuthStatus()">æ£€æŸ¥ OAuth çŠ¶æ€</button>
        <button class="btn" onclick="reinitializeOAuth()">é‡æ–°åˆå§‹åŒ– OAuth</button>
        <button class="btn" onclick="testLoginModal()">æµ‹è¯•ç™»å½•æ¨¡æ€æ¡†</button>
        <button class="btn" onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
    </div>
    
    <div class="status-card">
        <h3>è°ƒè¯•æ—¥å¿—</h3>
        <div id="debug-log"></div>
    </div>

    <!-- åŠ è½½å¿…è¦çš„è„šæœ¬ -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="i18n/zh.js"></script>
    <script src="i18n/en.js"></script>
    <script src="i18n/i18n.js"></script>
    <script src="components/modal.js"></script>
    <script src="components/message.js"></script>
    <script src="modules/google-oauth.js"></script>

    <script>
        // è°ƒè¯•æ—¥å¿—å‡½æ•°
        function debugLog(message) {
            const logElement = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        // æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        function checkSystemStatus() {
            const statusElement = document.getElementById('system-status');
            let html = '';

            // æ£€æŸ¥é…ç½®
            if (window.APP_CONFIG) {
                const oauthConfig = window.APP_CONFIG.GOOGLE_OAUTH;
                if (oauthConfig && oauthConfig.ENABLED) {
                    html += `<div class="status-good">âœ… Google OAuth å·²å¯ç”¨</div>`;
                    html += `<div>Client ID: ${oauthConfig.CLIENT_ID}</div>`;
                } else {
                    html += `<div class="status-error">âŒ Google OAuth æœªå¯ç”¨</div>`;
                }
            } else {
                html += `<div class="status-error">âŒ APP_CONFIG æœªæ‰¾åˆ°</div>`;
            }

            // æ£€æŸ¥æ¨¡å—
            if (window.GoogleOAuth) {
                html += `<div class="status-good">âœ… GoogleOAuth æ¨¡å—å·²åŠ è½½</div>`;
                html += `<div>åˆå§‹åŒ–çŠ¶æ€: ${window.GoogleOAuth.isInitialized ? 'å·²åˆå§‹åŒ–' : 'æœªåˆå§‹åŒ–'}</div>`;
                html += `<div>æ¼”ç¤ºæ¨¡å¼: ${window.GoogleOAuth.isDemoMode ? 'æ˜¯' : 'å¦'}</div>`;
            } else {
                html += `<div class="status-error">âŒ GoogleOAuth æ¨¡å—æœªåŠ è½½</div>`;
            }

            // æ£€æŸ¥æ¨¡æ€æ¡†ç»„ä»¶
            if (window.ModalComponent) {
                html += `<div class="status-good">âœ… ModalComponent å·²åŠ è½½</div>`;
            } else {
                html += `<div class="status-error">âŒ ModalComponent æœªåŠ è½½</div>`;
            }

            statusElement.innerHTML = html;
        }

        // æ£€æŸ¥ OAuth çŠ¶æ€
        function checkOAuthStatus() {
            debugLog('=== OAuth çŠ¶æ€æ£€æŸ¥ ===');
            
            if (!window.GoogleOAuth) {
                debugLog('âŒ GoogleOAuth æ¨¡å—æœªåŠ è½½');
                return;
            }

            debugLog(`åˆå§‹åŒ–çŠ¶æ€: ${window.GoogleOAuth.isInitialized}`);
            debugLog(`æ¼”ç¤ºæ¨¡å¼: ${window.GoogleOAuth.isDemoMode}`);
            debugLog(`é…ç½®: ${JSON.stringify(window.GoogleOAuth.config)}`);

            // æ£€æŸ¥é…ç½®
            if (window.APP_CONFIG && window.APP_CONFIG.GOOGLE_OAUTH) {
                debugLog(`OAuth å¯ç”¨: ${window.APP_CONFIG.GOOGLE_OAUTH.ENABLED}`);
                debugLog(`Client ID: ${window.APP_CONFIG.GOOGLE_OAUTH.CLIENT_ID}`);
            }

            // æ£€æŸ¥ç™»å½•æ¨¡æ€æ¡†ä¸­çš„å®¹å™¨
            const googleContainer = document.getElementById('google-signin-container');
            if (googleContainer) {
                debugLog(`âœ… Google å®¹å™¨å·²æ‰¾åˆ°ï¼Œå†…å®¹: ${googleContainer.innerHTML}`);
            } else {
                debugLog('âŒ Google å®¹å™¨æœªæ‰¾åˆ°');
            }
        }

        // é‡æ–°åˆå§‹åŒ– OAuth
        function reinitializeOAuth() {
            debugLog('=== é‡æ–°åˆå§‹åŒ– OAuth ===');
            
            if (!window.GoogleOAuth) {
                debugLog('âŒ GoogleOAuth æ¨¡å—æœªåŠ è½½');
                return;
            }

            // é‡ç½®çŠ¶æ€
            window.GoogleOAuth.isInitialized = false;
            window.GoogleOAuth.isDemoMode = false;

            // é‡æ–°åˆå§‹åŒ–
            window.GoogleOAuth.init();
            
            debugLog('âœ… OAuth é‡æ–°åˆå§‹åŒ–å®Œæˆ');
            
            // å»¶è¿Ÿæ£€æŸ¥çŠ¶æ€
            setTimeout(() => {
                checkOAuthStatus();
            }, 1000);
        }

        // æµ‹è¯•ç™»å½•æ¨¡æ€æ¡†
        function testLoginModal() {
            debugLog('=== æµ‹è¯•ç™»å½•æ¨¡æ€æ¡† ===');
            
            if (!window.ModalComponent) {
                debugLog('âŒ ModalComponent æœªåŠ è½½');
                return;
            }

            // åˆ›å»ºæ¨¡æ€æ¡†å…ƒç´ ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
            let loginModal = document.getElementById('login-modal');
            if (!loginModal) {
                loginModal = document.createElement('div');
                loginModal.id = 'login-modal';
                loginModal.className = 'fixed inset-0 bg-black bg-opacity-70 z-50 hidden flex items-center justify-center';
                document.body.appendChild(loginModal);
                debugLog('âœ… åˆ›å»ºäº†ç™»å½•æ¨¡æ€æ¡†å…ƒç´ ');
            }

            // åˆ›å»ºæ¨¡æ€æ¡†å†…å®¹
            window.ModalComponent.createLoginModal();
            debugLog('âœ… åˆ›å»ºäº†æ¨¡æ€æ¡†å†…å®¹');

            // æ‰“å¼€æ¨¡æ€æ¡†
            window.ModalComponent.open('login-modal');
            debugLog('âœ… æ‰“å¼€äº†ç™»å½•æ¨¡æ€æ¡†');

            // æ£€æŸ¥ Google å®¹å™¨
            setTimeout(() => {
                const googleContainer = document.getElementById('google-signin-container');
                if (googleContainer) {
                    debugLog(`Google å®¹å™¨å†…å®¹: ${googleContainer.innerHTML}`);
                } else {
                    debugLog('âŒ Google å®¹å™¨æœªæ‰¾åˆ°');
                }
            }, 500);
        }

        // æ¸…ç©ºæ—¥å¿—
        function clearLogs() {
            document.getElementById('debug-log').textContent = '';
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('ğŸš€ è°ƒè¯•é¡µé¢åŠ è½½å®Œæˆ');
            
            // ç­‰å¾…ä¸€æ®µæ—¶é—´è®©æ‰€æœ‰æ¨¡å—åˆå§‹åŒ–
            setTimeout(() => {
                checkSystemStatus();
                debugLog('ğŸ“Š ç³»ç»ŸçŠ¶æ€æ£€æŸ¥å®Œæˆ');
                
                // ç›‘å¬ OAuth å‡†å¤‡äº‹ä»¶
                if (window.EventUtils) {
                    window.EventUtils.on('google-oauth-ready', () => {
                        debugLog('ğŸ‰ æ”¶åˆ° google-oauth-ready äº‹ä»¶');
                        checkSystemStatus();
                    });
                }
            }, 1000);
        });

        // ç›‘å¬æ§åˆ¶å°æ—¥å¿—
        const originalLog = console.log;
        console.log = function(...args) {
            if (args[0] && args[0].includes && args[0].includes('oauth')) {
                debugLog(`Console: ${args.join(' ')}`);
            }
            originalLog.apply(console, args);
        };
    </script>
</body>
</html>