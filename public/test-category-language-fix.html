<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†ç±»è¯­è¨€åˆ‡æ¢ä¿®å¤æµ‹è¯•</title>
    <link rel="stylesheet" href="/css/admin.css">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #1a1a1a;
            border-radius: 10px;
            color: white;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.05);
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #f39c12;
        }
        
        .test-button {
            padding: 10px 20px;
            margin: 10px;
            background: #f39c12;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .test-button:hover {
            background: #e67e22;
        }
        
        .test-button.btn-primary {
            background: #3498db;
        }
        
        .test-button.btn-primary:hover {
            background: #2980b9;
        }
        
        .test-button.btn-success {
            background: #27ae60;
        }
        
        .test-button.btn-success:hover {
            background: #219a52;
        }
        
        .log-output {
            background: #000;
            color: #00ff00;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .warning { color: #ffaa00; }
        .info { color: #00aaff; }
        
        .product-form-container {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ”§ åˆ†ç±»è¯­è¨€åˆ‡æ¢ä¿®å¤æµ‹è¯•</h1>
        <p>æµ‹è¯•åˆ†ç±»åœ¨ä¸­è‹±æ–‡åˆ‡æ¢åèƒ½å¦æ­£ç¡®æ˜¾ç¤ºå¯¹åº”è¯­è¨€çš„åˆ†ç±»åç§°ï¼Œä»¥åŠæ–°å¢åˆ†ç±»åè‡ªåŠ¨åˆ·æ–°åŠŸèƒ½</p>
        
        <div class="test-section">
            <h3>ğŸ“‹ æµ‹è¯•é¡¹ç›®</h3>
            <ul>
                <li><strong>ä¼˜å…ˆé—®é¢˜ï¼š</strong>åˆ†ç±»åœ¨åˆ‡æ¢ä¸­è‹±æ–‡åï¼Œä»ç„¶åªæ˜¾ç¤ºä¸­æ–‡åˆ†ç±»</li>
                <li><strong>æ¬¡è¦é—®é¢˜ï¼š</strong>æ–°å¢åˆ†ç±»å¯ä»¥åˆ›å»ºæˆåŠŸï¼Œä½†éœ€è¦åˆ·æ–°ç½‘é¡µæ‰èƒ½åœ¨äº§å“ç¼–è¾‘é¡µçœ‹åˆ°æ–°å¢çš„åˆ†ç±»</li>
            </ul>
        </div>
        
        <div class="test-section">
            <h3>ğŸ› ï¸ æµ‹è¯•åŠŸèƒ½</h3>
            <button class="test-button" onclick="testModuleLoading()">1. æµ‹è¯•æ¨¡å—åŠ è½½</button>
            <button class="test-button btn-primary" onclick="testLanguageSwitching()">2. æµ‹è¯•è¯­è¨€åˆ‡æ¢</button>
            <button class="test-button btn-success" onclick="testCategoryRefresh()">3. æµ‹è¯•åˆ†ç±»åˆ·æ–°</button>
            <button class="test-button" onclick="simulateAddCategory()">4. æ¨¡æ‹Ÿæ–°å¢åˆ†ç±»</button>
            <button class="test-button" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        </div>
        
        <!-- æ¨¡æ‹Ÿäº§å“è¡¨å•ç•Œé¢ -->
        <div class="test-section">
            <h3>ğŸ“ äº§å“è¡¨å•æ¨¡æ‹Ÿç•Œé¢</h3>
            <div id="product-form-container" class="product-form-container">
                <!-- äº§å“è¡¨å•å†…å®¹å°†åœ¨è¿™é‡Œæ¸²æŸ“ -->
            </div>
        </div>
        
        <div class="log-output" id="log-output"></div>
    </div>

    <script>
        // é‡å†™console.logä»¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        
        function appendLog(message, type = 'log') {
            const logOutput = document.getElementById('log-output');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'warn' ? 'warning' : type === 'info' ? 'info' : 'success';
            logOutput.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logOutput.scrollTop = logOutput.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            appendLog(args.join(' '), 'log');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            appendLog(args.join(' '), 'warn');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            appendLog(args.join(' '), 'error');
        };
        
        console.info = function(...args) {
            originalLog.apply(console, args);
            appendLog(args.join(' '), 'info');
        };
        
        // æµ‹è¯•å‡½æ•°
        function testModuleLoading() {
            console.info('=== æµ‹è¯•æ¨¡å—åŠ è½½ ===');
            
            const functions = [
                { name: 'initializeProductForm', desc: 'äº§å“è¡¨å•åˆå§‹åŒ–' },
                { name: 'switchLanguage', desc: 'è¯­è¨€åˆ‡æ¢' },
                { name: 'loadCategories', desc: 'åŠ è½½åˆ†ç±»ï¼ˆäº§å“è¡¨å•ï¼‰' },
                { name: 'refreshCategories', desc: 'åˆ·æ–°åˆ†ç±»' },
                { name: 'loadCategoryList', desc: 'åŠ è½½åˆ†ç±»åˆ—è¡¨ï¼ˆåˆ†ç±»ç®¡ç†ï¼‰' },
                { name: 'addNewCategory', desc: 'æ–°å¢åˆ†ç±»' }
            ];
            
            functions.forEach(func => {
                const available = typeof window[func.name] === 'function';
                if (available) {
                    console.log(`âœ… ${func.desc} - ${func.name}() å¯ç”¨`);
                } else {
                    console.error(`âŒ ${func.desc} - ${func.name}() æœªæ‰¾åˆ°`);
                }
            });
            
            // åˆå§‹åŒ–äº§å“è¡¨å•
            if (typeof window.initializeProductForm === 'function') {
                console.info('å¼€å§‹åˆå§‹åŒ–äº§å“è¡¨å•...');
                try {
                    window.initializeProductForm();
                    console.log('âœ… äº§å“è¡¨å•åˆå§‹åŒ–æˆåŠŸ');
                } catch (error) {
                    console.error(`âŒ äº§å“è¡¨å•åˆå§‹åŒ–å¤±è´¥: ${error.message}`);
                }
            }
        }
        
        function testLanguageSwitching() {
            console.info('=== æµ‹è¯•è¯­è¨€åˆ‡æ¢åŠŸèƒ½ ===');
            
            // æ£€æŸ¥åˆ†ç±»ä¸‹æ‹‰æ¡†æ˜¯å¦å­˜åœ¨
            const categorySelect = document.getElementById('product-category');
            if (!categorySelect) {
                console.error('âŒ åˆ†ç±»ä¸‹æ‹‰æ¡†æœªæ‰¾åˆ°ï¼Œè¯·å…ˆåˆå§‹åŒ–äº§å“è¡¨å•');
                return;
            }
            
            console.log('âœ… åˆ†ç±»ä¸‹æ‹‰æ¡†å­˜åœ¨');
            
            // æµ‹è¯•è¯­è¨€åˆ‡æ¢å‡½æ•°
            if (typeof window.switchLanguage !== 'function') {
                console.error('âŒ switchLanguage å‡½æ•°æœªæ‰¾åˆ°');
                return;
            }
            
            console.log('âœ… switchLanguage å‡½æ•°å¯ç”¨');
            
            // æ¨¡æ‹Ÿè¯­è¨€åˆ‡æ¢æµ‹è¯•
            async function testSwitch() {
                console.info('ğŸ“ å¼€å§‹æµ‹è¯•è¯­è¨€åˆ‡æ¢...');
                
                // è®°å½•åˆ‡æ¢å‰çš„åˆ†ç±»é€‰é¡¹
                const beforeOptions = Array.from(categorySelect.options).map(opt => ({
                    value: opt.value,
                    text: opt.textContent
                }));
                console.log('åˆ‡æ¢å‰åˆ†ç±»é€‰é¡¹:', beforeOptions);
                
                // åˆ‡æ¢åˆ°è‹±æ–‡
                console.info('ğŸ”„ åˆ‡æ¢åˆ°è‹±æ–‡...');
                await window.switchLanguage('en');
                
                // ç­‰å¾…ä¸€ç§’è®©APIè°ƒç”¨å®Œæˆ
                setTimeout(() => {
                    const afterOptions = Array.from(categorySelect.options).map(opt => ({
                        value: opt.value,
                        text: opt.textContent
                    }));
                    console.log('åˆ‡æ¢ååˆ†ç±»é€‰é¡¹:', afterOptions);
                    
                    // æ¯”è¾ƒé€‰é¡¹å˜åŒ–
                    const hasChanged = JSON.stringify(beforeOptions) !== JSON.stringify(afterOptions);
                    if (hasChanged) {
                        console.log('âœ… è¯­è¨€åˆ‡æ¢æˆåŠŸï¼Œåˆ†ç±»é€‰é¡¹å·²æ›´æ–°');
                    } else {
                        console.warn('âš ï¸  åˆ†ç±»é€‰é¡¹æ²¡æœ‰å˜åŒ–ï¼Œå¯èƒ½éœ€è¦æœåŠ¡å™¨æ”¯æŒ');
                    }
                    
                    // åˆ‡æ¢å›ä¸­æ–‡
                    setTimeout(async () => {
                        console.info('ğŸ”„ åˆ‡æ¢å›ä¸­æ–‡...');
                        await window.switchLanguage('zh');
                        console.log('âœ… è¯­è¨€åˆ‡æ¢æµ‹è¯•å®Œæˆ');
                    }, 1000);
                }, 1000);
            }
            
            testSwitch();
        }
        
        function testCategoryRefresh() {
            console.info('=== æµ‹è¯•åˆ†ç±»åˆ·æ–°åŠŸèƒ½ ===');
            
            if (typeof window.refreshCategories !== 'function') {
                console.error('âŒ refreshCategories å‡½æ•°æœªæ‰¾åˆ°');
                return;
            }
            
            console.log('âœ… refreshCategories å‡½æ•°å¯ç”¨');
            
            // è®°å½•åˆ·æ–°å‰çš„åˆ†ç±»é€‰é¡¹
            const categorySelect = document.getElementById('product-category');
            if (categorySelect) {
                const beforeOptions = Array.from(categorySelect.options).map(opt => opt.textContent);
                console.log('åˆ·æ–°å‰åˆ†ç±»é€‰é¡¹:', beforeOptions);
                
                // æ‰§è¡Œåˆ·æ–°
                console.info('ğŸ”„ æ‰§è¡Œåˆ†ç±»åˆ·æ–°...');
                window.refreshCategories().then(() => {
                    setTimeout(() => {
                        const afterOptions = Array.from(categorySelect.options).map(opt => opt.textContent);
                        console.log('åˆ·æ–°ååˆ†ç±»é€‰é¡¹:', afterOptions);
                        console.log('âœ… åˆ†ç±»åˆ·æ–°æµ‹è¯•å®Œæˆ');
                    }, 500);
                }).catch(error => {
                    console.error(`âŒ åˆ†ç±»åˆ·æ–°å¤±è´¥: ${error.message}`);
                });
            }
        }
        
        function simulateAddCategory() {
            console.info('=== æ¨¡æ‹Ÿæ–°å¢åˆ†ç±»æ“ä½œ ===');
            
            // æ¨¡æ‹Ÿåˆ†ç±»ç®¡ç†æ¨¡å—çš„è¡Œä¸º
            const mockSaveSuccess = () => {
                console.info('ğŸ“ æ¨¡æ‹Ÿåˆ†ç±»ä¿å­˜æˆåŠŸ...');
                
                // æ¨¡æ‹Ÿè°ƒç”¨ refreshCategories
                if (typeof window.refreshCategories === 'function') {
                    console.info('ğŸ”„ è°ƒç”¨ refreshCategories...');
                    window.refreshCategories();
                    console.log('âœ… å·²é€šçŸ¥äº§å“è¡¨å•åˆ·æ–°åˆ†ç±»');
                } else {
                    console.error('âŒ refreshCategories å‡½æ•°æœªæ‰¾åˆ°');
                }
            };
            
            // å»¶è¿Ÿæ¨¡æ‹Ÿä¿å­˜æ“ä½œ
            setTimeout(mockSaveSuccess, 1000);
        }
        
        function clearLog() {
            document.getElementById('log-output').innerHTML = '';
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡ŒåŸºç¡€æµ‹è¯•
        window.addEventListener('load', () => {
            console.info('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åŸºç¡€æµ‹è¯•...');
            setTimeout(() => {
                testModuleLoading();
            }, 1000);
        });
    </script>
    
    <!-- åŠ è½½å®é™…çš„æ¨¡å—æ–‡ä»¶ -->
    <script src="/modules/category-management.js"></script>
    <script src="/modules/product-form.js"></script>
    <script src="/modules/product-management.js" type="module"></script>
</body>
</html>