<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº§å“æ•°æ®å¡«å……æµ‹è¯•</title>
    <link rel="stylesheet" href="/css/admin.css">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #1a1a1a;
            border-radius: 10px;
        }
        
        .test-button {
            padding: 10px 20px;
            margin: 10px;
            background: #f39c12;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .test-button:hover {
            background: #e67e22;
        }
        
        .log-output {
            background: #000;
            color: #00ff00;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª äº§å“ç®¡ç†æ¨¡å—æµ‹è¯•</h1>
        
        <div class="test-buttons">
            <button class="test-button" onclick="testLoadModules()">åŠ è½½æ¨¡å—</button>
            <button class="test-button" onclick="testOpenEditor()">æ‰“å¼€ç¼–è¾‘å™¨</button>
            <button class="test-button" onclick="testDataPopulation()">æµ‹è¯•æ•°æ®å¡«å……</button>
            <button class="test-button" onclick="testCategoryDropdown()">æµ‹è¯•åˆ†ç±»ä¸‹æ‹‰æ¡†</button>
            <button class="test-button" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        </div>
        
        <div class="log-output" id="log-output"></div>
    </div>

    <!-- äº§å“ç¼–è¾‘å™¨å®¹å™¨ä¼šåŠ¨æ€æ’å…¥åˆ°è¿™é‡Œ -->
    
    <script>
        // é‡å†™console.logä»¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        
        function appendLog(message, type = 'log') {
            const logOutput = document.getElementById('log-output');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff0000' : type === 'warn' ? '#ffaa00' : '#00ff00';
            logOutput.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logOutput.scrollTop = logOutput.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            appendLog(args.join(' '), 'log');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            appendLog(args.join(' '), 'warn');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            appendLog(args.join(' '), 'error');
        };
        
        // æµ‹è¯•å‡½æ•°
        async function testLoadModules() {
            console.log('=== å¼€å§‹åŠ è½½æ¨¡å—æµ‹è¯• ===');
            
            try {
                console.log('åŠ è½½äº§å“ç¼–è¾‘å™¨æ¨¡å—...');
                const editorModule = await import('/modules/product-editor.js');
                console.log('äº§å“ç¼–è¾‘å™¨æ¨¡å—åŠ è½½æˆåŠŸ');
                
                console.log('åŠ è½½äº§å“è¡¨å•æ¨¡å—...');
                const formModule = await import('/modules/product-form.js');
                console.log('äº§å“è¡¨å•æ¨¡å—åŠ è½½æˆåŠŸ');
                
                console.log('åŠ è½½äº§å“åª’ä½“æ¨¡å—...');
                const mediaModule = await import('/modules/product-media.js');
                console.log('äº§å“åª’ä½“æ¨¡å—åŠ è½½æˆåŠŸ');
                
                console.log('åˆå§‹åŒ–äº§å“ç¼–è¾‘å™¨...');
                if (typeof window.initializeProductEditor === 'function') {
                    window.initializeProductEditor();
                    console.log('äº§å“ç¼–è¾‘å™¨åˆå§‹åŒ–å®Œæˆ');
                } else {
                    console.error('äº§å“ç¼–è¾‘å™¨åˆå§‹åŒ–å‡½æ•°ä¸å­˜åœ¨');
                }
                
            } catch (error) {
                console.error('æ¨¡å—åŠ è½½å¤±è´¥:', error.message);
            }
        }
        
        function testOpenEditor() {
            console.log('=== å¼€å§‹ç¼–è¾‘å™¨æ‰“å¼€æµ‹è¯• ===');
            
            if (typeof window.openProductEditor === 'function') {
                const testData = {
                    id: 1,
                    name_zh: 'æµ‹è¯•äº§å“ä¸­æ–‡å',
                    name_en: 'Test Product English Name',
                    description_zh: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•äº§å“çš„ä¸­æ–‡æè¿°',
                    description_en: 'This is a test product English description',
                    price: 99.99,
                    categoryId: 'test-category',
                    featured: true
                };
                
                console.log('ä½¿ç”¨æµ‹è¯•æ•°æ®æ‰“å¼€ç¼–è¾‘å™¨:', testData);
                window.openProductEditor(testData, 'edit');
            } else {
                console.error('openProductEditorå‡½æ•°ä¸å­˜åœ¨');
            }
        }
        
        function testDataPopulation() {
            console.log('=== å¼€å§‹æ•°æ®å¡«å……æµ‹è¯• ===');
            
            const testData = {
                id: 2,
                name_zh: 'æ‰‹å·¥é›•åˆ»æ¡ƒæœ¨å‰‘',
                name_en: 'Hand-Carved Peach Wood Sword',
                description_zh: 'å–æ•´å—ç™¾å¹´æ¡ƒæœ¨ï¼Œç”±èµ„æ·±é“å®¶åŒ äººæ‰‹å·¥é›•åˆ»è€Œæˆã€‚æ¡ƒæœ¨è‡ªå¤ä¸ºè¾Ÿé‚ªä¹‹æœ¨ï¼Œæ­¤å‰‘æ‚¬æŒ‚äºå®¤ï¼Œå¯æ–©æ–­é‚ªç¥Ÿï¼Œå‡€åŒ–ç£åœºï¼Œäº¦å¯ç”¨äºç§‘ä»ªæ³•äº‹ï¼Œæ˜¯é•‡å®…æŠ¤èº«çš„ä¸Šä½³ä¹‹é€‰ã€‚',
                description_en: 'A traditional Taoist ritual sword, hand-carved from century-old peach wood by experienced craftsmen.',
                price: 168.88,
                categoryId: 'spiritual-tools',
                featured: true
            };
            
            console.log('æµ‹è¯•æ•°æ®:', testData);
            
            if (typeof window.populateProductFormData === 'function') {
                console.log('ç›´æ¥è°ƒç”¨æ•°æ®å¡«å……å‡½æ•°...');
                window.populateProductFormData(testData);
            } else {
                console.error('populateProductFormDataå‡½æ•°ä¸å­˜åœ¨');
            }
        }
        
        function testLanguageSwitchBug() {
            console.log('=== æµ‹è¯•è¯­è¨€åˆ‡æ¢Bug ===');
            
            // é¦–å…ˆåŠ è½½æ¨¡å—
            testLoadModules();
            
            setTimeout(() => {
                // æ‰“å¼€ç¼–è¾‘å™¨
                const testData = {
                    id: 1,
                    name_zh: 'ä¸­æ–‡äº§å“åç§°',
                    name_en: 'English Product Name',
                    description_zh: 'ä¸­æ–‡äº§å“æè¿°å†…å®¹',
                    description_en: 'English product description content',
                    price: 99.99,
                    categoryId: 'test-category',
                    featured: true
                };
                
                console.log('æ‰“å¼€ç¼–è¾‘å™¨å¹¶å¡«å……æµ‹è¯•æ•°æ®...');
                if (typeof window.openProductEditor === 'function') {
                    window.openProductEditor(testData, 'edit');
                    
                    // ç­‰å¾…ç¼–è¾‘å™¨åŠ è½½å®Œæˆ
                    setTimeout(() => {
                        console.log('ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥åˆå§‹ä¸­æ–‡æ•°æ®æ˜¾ç¤º');
                        checkFormData('zh');
                        
                        setTimeout(() => {
                            console.log('ç¬¬äºŒæ­¥ï¼šåˆ‡æ¢åˆ°è‹±æ–‡');
                            if (typeof window.switchLanguageTab === 'function') {
                                window.switchLanguageTab('en');
                                
                                setTimeout(() => {
                                    console.log('ç¬¬ä¸‰æ­¥ï¼šæ£€æŸ¥è‹±æ–‡æ•°æ®æ˜¾ç¤º');
                                    checkFormData('en');
                                    
                                    setTimeout(() => {
                                        console.log('ç¬¬å››æ­¥ï¼šåˆ‡æ¢å›ä¸­æ–‡');
                                        window.switchLanguageTab('zh');
                                        
                                        setTimeout(() => {
                                            console.log('ç¬¬äº”æ­¥ï¼šæ£€æŸ¥ä¸­æ–‡æ•°æ®æ˜¯å¦ä¿æŒ');
                                            checkFormData('zh');
                                            console.log('è¯­è¨€åˆ‡æ¢Bugæµ‹è¯•å®Œæˆ');
                                        }, 1000);
                                    }, 1000);
                                }, 1000);
                            }
                        }, 2000);
                    }, 3000);
                }
            }, 2000);
        }
        
        function checkDOMStructure() {
            console.log('=== æ£€æŸ¥DOMç»“æ„ ===');
            
            // æ£€æŸ¥è¯­è¨€æ ‡ç­¾
            const zhTab = document.querySelector('[onclick*="zh"]');
            const enTab = document.querySelector('[onclick*="en"]');
            
            console.log('ä¸­æ–‡æ ‡ç­¾:', zhTab ? `æ‰¾åˆ° - ${zhTab.textContent}` : 'æœªæ‰¾åˆ°');
            console.log('è‹±æ–‡æ ‡ç­¾:', enTab ? `æ‰¾åˆ° - ${enTab.textContent}` : 'æœªæ‰¾åˆ°');
            
            // æ£€æŸ¥è¯­è¨€å†…å®¹åŒºåŸŸ
            const zhContent = document.getElementById('zh-form-content');
            const enContent = document.getElementById('en-form-content');
            
            console.log('ä¸­æ–‡å†…å®¹åŒºåŸŸ:', zhContent ? `æ‰¾åˆ° - ID: ${zhContent.id}` : 'æœªæ‰¾åˆ°');
            console.log('è‹±æ–‡å†…å®¹åŒºåŸŸ:', enContent ? `æ‰¾åˆ° - ID: ${enContent.id}` : 'æœªæ‰¾åˆ°');
            
            if (zhContent) {
                const computedStyle = window.getComputedStyle(zhContent);
                console.log(`ä¸­æ–‡å†…å®¹åŒºåŸŸçŠ¶æ€: display=${computedStyle.display}, active=${zhContent.classList.contains('active')}`);
            }
            
            if (enContent) {
                const computedStyle = window.getComputedStyle(enContent);
                console.log(`è‹±æ–‡å†…å®¹åŒºåŸŸçŠ¶æ€: display=${computedStyle.display}, active=${enContent.classList.contains('active')}`);
            }
            
            // æ£€æŸ¥è¾“å…¥æ¡†
            const inputs = [
                'product-name-zh', 'product-name-en',
                'product-description-zh', 'product-description-en',
                'product-price', 'product-category', 'product-featured'
            ];
            
            console.log('è¾“å…¥æ¡†æ£€æŸ¥:');
            inputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                console.log(`- ${inputId}: ${input ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`);
            });
        }
        
        function testCategoryDropdown() {
            console.log('=== æµ‹è¯•åˆ†ç±»ä¸‹æ‹‰æ¡†æ ·å¼ ===');
            
            // é¦–å…ˆåŠ è½½æ¨¡å—å¹¶æ‰“å¼€ç¼–è¾‘å™¨
            testLoadModules();
            
            setTimeout(() => {
                const testData = {
                    id: 1,
                    name_zh: 'æµ‹è¯•äº§å“',
                    name_en: 'Test Product',
                    description_zh: 'æµ‹è¯•æè¿°',
                    description_en: 'Test description',
                    price: 99.99,
                    categoryId: 'test',
                    featured: true
                };
                
                if (typeof window.openProductEditor === 'function') {
                    window.openProductEditor(testData, 'edit');
                    
                    setTimeout(() => {
                        console.log('æ£€æŸ¥åˆ†ç±»ä¸‹æ‹‰æ¡†å…ƒç´ :');
                        
                        const categorySelect = document.getElementById('product-category');
                        if (categorySelect) {
                            console.log('åˆ†ç±»ä¸‹æ‹‰æ¡†å·²æ‰¾åˆ°');
                            
                            // æ£€æŸ¥æ ·å¼æ˜¯å¦æ­£ç¡®åº”ç”¨
                            const computedStyle = window.getComputedStyle(categorySelect);
                            console.log('ä¸‹æ‹‰æ¡†æ ·å¼:');
                            console.log(`- background: ${computedStyle.background}`);
                            console.log(`- color: ${computedStyle.color}`);
                            console.log(`- border: ${computedStyle.border}`);
                            
                            // æ£€æŸ¥é€‰é¡¹
                            const options = categorySelect.querySelectorAll('option');
                            console.log(`æ‰¾åˆ° ${options.length} ä¸ªé€‰é¡¹`);
                            
                            if (options.length > 0) {
                                const firstOption = options[0];
                                const optionStyle = window.getComputedStyle(firstOption);
                                console.log('ç¬¬ä¸€ä¸ªé€‰é¡¹æ ·å¼:');
                                console.log(`- background: ${optionStyle.background}`);
                                console.log(`- color: ${optionStyle.color}`);
                            }
                            
                            console.log('è¯·æ‰‹åŠ¨ç‚¹å‡»ä¸‹æ‹‰æ¡†æŸ¥çœ‹æ ·å¼æ˜¯å¦æ­£å¸¸');
                        } else {
                            console.error('åˆ†ç±»ä¸‹æ‹‰æ¡†æœªæ‰¾åˆ°');
                        }
                    }, 3000);
                }
            }, 2000);
        }
        
        function clearLog() {
            document.getElementById('log-output').innerHTML = '';
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æµ‹è¯•
        window.addEventListener('load', () => {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹è‡ªåŠ¨æµ‹è¯•...');
            setTimeout(testLoadModules, 1000);
        });
    </script>
</body>
</html>