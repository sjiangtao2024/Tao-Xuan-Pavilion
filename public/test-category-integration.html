<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°å¢åˆ†ç±»åŠŸèƒ½é›†æˆæµ‹è¯•</title>
    <link rel="stylesheet" href="/css/admin.css">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #1a1a1a;
            border-radius: 10px;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.05);
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #f39c12;
        }
        
        .test-button {
            padding: 10px 20px;
            margin: 10px;
            background: #f39c12;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .test-button:hover {
            background: #e67e22;
        }
        
        .test-button.btn-primary {
            background: #3498db;
        }
        
        .test-button.btn-primary:hover {
            background: #2980b9;
        }
        
        .log-output {
            background: #000;
            color: #00ff00;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .warning { color: #ffaa00; }
        .info { color: #00aaff; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª æ–°å¢åˆ†ç±»åŠŸèƒ½é›†æˆæµ‹è¯•</h1>
        <p>æµ‹è¯•äº§å“ç®¡ç†ç•Œé¢ä¸­æ–°å¢åˆ†ç±»åŠŸèƒ½çš„é›†æˆæƒ…å†µ</p>
        
        <!-- æ¨¡æ‹Ÿäº§å“ç®¡ç†ç•Œé¢ç»“æ„ -->
        <div class="test-section">
            <h3>1. äº§å“ç®¡ç†ç•Œé¢æ¨¡æ‹Ÿ</h3>
            <p>æ¨¡æ‹Ÿadmin.htmlä¸­çš„äº§å“ç®¡ç†éƒ¨åˆ†ç»“æ„ï¼š</p>
            
            <div id="products-section" class="section">
                <div class="data-table">
                    <h3>äº§å“ç®¡ç†</h3>
                    <div class="table-actions">
                        <button id="add-product-btn" class="btn btn-success test-button">æ–°å¢äº§å“</button>
                        <button id="add-category-btn" class="btn btn-primary test-button">æ–°å¢åˆ†ç±»</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>äº§å“åç§°</th>
                                <th>ä»·æ ¼ (USD)</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>æµ‹è¯•äº§å“</td>
                                <td>99.99</td>
                                <td>æ­£å¸¸</td>
                                <td>
                                    <button class="view-product-btn btn test-button" data-product-id="1">æŸ¥çœ‹</button>
                                    <button class="btn btn-danger test-button">åˆ é™¤</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>2. åŠŸèƒ½æµ‹è¯•</h3>
            <button class="test-button" onclick="testModuleLoading()">æµ‹è¯•æ¨¡å—åŠ è½½</button>
            <button class="test-button" onclick="testButtonExistence()">æµ‹è¯•æŒ‰é’®å­˜åœ¨æ€§</button>
            <button class="test-button" onclick="testFunctionAvailability()">æµ‹è¯•å‡½æ•°å¯ç”¨æ€§</button>
            <button class="test-button" onclick="testCategoryManagement()">æµ‹è¯•åˆ†ç±»ç®¡ç†æ¨¡å—</button>
            <button class="test-button" onclick="testIntegration()">æµ‹è¯•å®Œæ•´é›†æˆ</button>
            <button class="test-button" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        </div>
        
        <div class="log-output" id="log-output"></div>
    </div>

    <script>
        // é‡å†™console.logä»¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        
        function appendLog(message, type = 'log') {
            const logOutput = document.getElementById('log-output');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'warn' ? 'warning' : type === 'info' ? 'info' : 'success';
            logOutput.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logOutput.scrollTop = logOutput.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            appendLog(args.join(' '), 'log');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            appendLog(args.join(' '), 'warn');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            appendLog(args.join(' '), 'error');
        };
        
        console.info = function(...args) {
            originalLog.apply(console, args);
            appendLog(args.join(' '), 'info');
        };
        
        // æµ‹è¯•å‡½æ•°
        function testModuleLoading() {
            console.info('=== æµ‹è¯•æ¨¡å—åŠ è½½ ===');
            
            const modules = [
                { name: 'äº§å“ç®¡ç†æ¨¡å—', check: 'initializeProductManagementModule' },
                { name: 'åˆ†ç±»ç®¡ç†æ¨¡å—', check: 'initializeCategoryManagementModule' },
                { name: 'äº§å“è¡¨å•æ¨¡å—', check: 'initializeProductForm' },
                { name: 'äº§å“åª’ä½“æ¨¡å—', check: 'initializeProductMedia' },
                { name: 'äº§å“ç¼–è¾‘å™¨æ¨¡å—', check: 'initializeProductEditor' }
            ];
            
            modules.forEach(module => {
                const available = typeof window[module.check] === 'function';
                if (available) {
                    console.log(`âœ… ${module.name} å¯ç”¨`);
                } else {
                    console.error(`âŒ ${module.name} æœªæ‰¾åˆ°`);
                }
            });
        }
        
        function testButtonExistence() {
            console.info('=== æµ‹è¯•æŒ‰é’®å­˜åœ¨æ€§ ===');
            
            const buttons = [
                { id: 'add-product-btn', name: 'æ–°å¢äº§å“æŒ‰é’®' },
                { id: 'add-category-btn', name: 'æ–°å¢åˆ†ç±»æŒ‰é’®' }
            ];
            
            buttons.forEach(button => {
                const element = document.getElementById(button.id);
                if (element) {
                    console.log(`âœ… ${button.name} å­˜åœ¨ - ID: ${button.id}`);
                    console.log(`   æ–‡æœ¬å†…å®¹: "${element.textContent.trim()}"`);
                    console.log(`   CSSç±»: ${element.className}`);
                } else {
                    console.error(`âŒ ${button.name} ä¸å­˜åœ¨ - ID: ${button.id}`);
                }
            });
        }
        
        function testFunctionAvailability() {
            console.info('=== æµ‹è¯•å‡½æ•°å¯ç”¨æ€§ ===');
            
            const functions = [
                { name: 'addNewProduct', desc: 'æ–°å¢äº§å“å‡½æ•°' },
                { name: 'addNewCategory', desc: 'æ–°å¢åˆ†ç±»å‡½æ•°ï¼ˆå…¨å±€ï¼‰' },
                { name: 'addNewCategoryFromModule', desc: 'æ–°å¢åˆ†ç±»å‡½æ•°ï¼ˆæ¨¡å—ï¼‰' },
                { name: 'viewProduct', desc: 'æŸ¥çœ‹äº§å“å‡½æ•°' },
                { name: 'editProduct', desc: 'ç¼–è¾‘äº§å“å‡½æ•°' },
                { name: 'deleteProduct', desc: 'åˆ é™¤äº§å“å‡½æ•°' }
            ];
            
            functions.forEach(func => {
                const available = typeof window[func.name] === 'function';
                if (available) {
                    console.log(`âœ… ${func.desc} å¯ç”¨ - ${func.name}()`);
                } else {
                    console.error(`âŒ ${func.desc} æœªæ‰¾åˆ° - ${func.name}()`);
                }
            });
        }
        
        function testCategoryManagement() {
            console.info('=== æµ‹è¯•åˆ†ç±»ç®¡ç†æ¨¡å— ===');
            
            // æ£€æŸ¥åˆ†ç±»ç®¡ç†ç›¸å…³å‡½æ•°
            const categoryFunctions = [
                'initializeCategoryManagementModule',
                'addNewCategory',
                'editCategory',
                'saveCategory',
                'deleteCategory',
                'loadCategoryList',
                'renderCategoryList'
            ];
            
            categoryFunctions.forEach(funcName => {
                const available = typeof window[funcName] === 'function';
                if (available) {
                    console.log(`âœ… ${funcName} å¯ç”¨`);
                } else {
                    console.warn(`âš ï¸  ${funcName} æœªæ‰¾åˆ°ï¼ˆå¯èƒ½åœ¨æ¨¡å—å†…éƒ¨ï¼‰`);
                }
            });
            
            // å°è¯•åˆå§‹åŒ–åˆ†ç±»ç®¡ç†æ¨¡å—
            if (typeof window.initializeCategoryManagementModule === 'function') {
                try {
                    console.info('å°è¯•åˆå§‹åŒ–åˆ†ç±»ç®¡ç†æ¨¡å—...');
                    window.initializeCategoryManagementModule();
                    console.log('âœ… åˆ†ç±»ç®¡ç†æ¨¡å—åˆå§‹åŒ–æˆåŠŸ');
                } catch (error) {
                    console.error(`âŒ åˆ†ç±»ç®¡ç†æ¨¡å—åˆå§‹åŒ–å¤±è´¥: ${error.message}`);
                }
            }
        }
        
        function testIntegration() {
            console.info('=== æµ‹è¯•å®Œæ•´é›†æˆ ===');
            
            // 1. æ£€æŸ¥æ–°å¢åˆ†ç±»æŒ‰é’®æ˜¯å¦å­˜åœ¨
            const addCategoryBtn = document.getElementById('add-category-btn');
            if (!addCategoryBtn) {
                console.error('âŒ æ–°å¢åˆ†ç±»æŒ‰é’®ä¸å­˜åœ¨');
                return;
            }
            console.log('âœ… æ–°å¢åˆ†ç±»æŒ‰é’®å­˜åœ¨');
            
            // 2. æ¨¡æ‹Ÿç‚¹å‡»æ–°å¢åˆ†ç±»æŒ‰é’®
            console.info('æ¨¡æ‹Ÿç‚¹å‡»æ–°å¢åˆ†ç±»æŒ‰é’®...');
            
            // å…ˆæ£€æŸ¥æ˜¯å¦æœ‰äº‹ä»¶ç›‘å¬å™¨
            const hasEventListener = addCategoryBtn.onclick || 
                                  addCategoryBtn.addEventListener ||
                                  typeof window.addNewCategory === 'function';
            
            if (hasEventListener) {
                console.log('âœ… æ–°å¢åˆ†ç±»æŒ‰é’®æœ‰ç›¸å…³å¤„ç†é€»è¾‘');
                
                // æ¨¡æ‹Ÿç‚¹å‡»äº‹ä»¶
                try {
                    if (typeof window.addNewCategory === 'function') {
                        console.info('è°ƒç”¨ window.addNewCategory()...');
                        window.addNewCategory();
                    } else {
                        console.info('è§¦å‘æŒ‰é’®ç‚¹å‡»äº‹ä»¶...');
                        addCategoryBtn.click();
                    }
                } catch (error) {
                    console.error(`âŒ æ‰§è¡Œæ–°å¢åˆ†ç±»åŠŸèƒ½æ—¶å‡ºé”™: ${error.message}`);
                }
            } else {
                console.error('âŒ æ–°å¢åˆ†ç±»æŒ‰é’®ç¼ºå°‘äº‹ä»¶å¤„ç†');
            }
            
            // 3. æ£€æŸ¥åˆ†ç±»æ¨¡æ€æ¡†æ˜¯å¦å‡ºç°
            setTimeout(() => {
                const categoryModal = document.getElementById('category-modal');
                if (categoryModal) {
                    const isVisible = categoryModal.style.display === 'block' || 
                                    !categoryModal.style.display && 
                                    getComputedStyle(categoryModal).display === 'block';
                    
                    if (isVisible) {
                        console.log('âœ… åˆ†ç±»ç®¡ç†æ¨¡æ€æ¡†å·²æ˜¾ç¤º');
                    } else {
                        console.warn('âš ï¸  åˆ†ç±»ç®¡ç†æ¨¡æ€æ¡†å­˜åœ¨ä½†æœªæ˜¾ç¤º');
                    }
                } else {
                    console.error('âŒ åˆ†ç±»ç®¡ç†æ¨¡æ€æ¡†ä¸å­˜åœ¨');
                }
            }, 1000);
        }
        
        function clearLog() {
            document.getElementById('log-output').innerHTML = '';
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ‰§è¡ŒåŸºç¡€æµ‹è¯•
        window.addEventListener('load', () => {
            console.info('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åŸºç¡€æµ‹è¯•...');
            setTimeout(() => {
                testButtonExistence();
            }, 1000);
        });
    </script>
    
    <!-- åŠ è½½å®é™…çš„æ¨¡å—æ–‡ä»¶ -->
    <script src="/modules/category-management.js"></script>
    <script src="/modules/product-management.js" type="module"></script>
    <script src="/js/admin.js" type="module"></script>
</body>
</html>